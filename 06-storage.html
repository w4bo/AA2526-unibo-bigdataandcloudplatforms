<!DOCTYPE html>
<html lang="en"><head>
<script src="06-storage_files/libs/quarto-html/tabby.min.js"></script>
<script src="06-storage_files/libs/quarto-html/popper.min.js"></script>
<script src="06-storage_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="06-storage_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="06-storage_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="06-storage_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Matteo Francia   DISI — University of Bologna   m.francia@unibo.it">
  <title>Big Data and Cloud Platforms (Module 2)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="06-storage_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="06-storage_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="06-storage_files/libs/revealjs/dist/theme/quarto-ed3ed8e2bee100c8aba16b41caadc9a2.css">
  <link href="06-storage_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="06-storage_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="06-storage_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="06-storage_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Big Data and Cloud Platforms (Module 2)</h1>
  <p class="subtitle">Data pipelines on cloud (Storage)</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Matteo Francia <br> DISI — University of Bologna <br> m.francia@unibo.it 
</div>
</div>
</div>

</section>
<section id="section" class="title-slide slide level1 center">
<h1></h1>

<img data-src="imgs/249.svg" class="r-stretch quarto-figure-center"><p class="caption">Storage</p></section>

<section id="storage" class="title-slide slide level1 center">
<h1>Storage</h1>
<p><strong>Goal</strong>: persisting data</p>
<p>What storage do we choose?</p>
<ul>
<li><strong>Storage model</strong> (or data model) ~= variety
<ul>
<li>How data are organized/accessed in a storage system
<ul>
<li>Structured vs unstructured</li>
<li>Data access model (key-value, column, etc.)</li>
</ul></li>
</ul></li>
<li>Access <strong>frequency</strong></li>
<li><strong>Analyses</strong> to be performed</li>
</ul>
</section>

<section id="storage-models" class="title-slide slide level1 center">
<h1>Storage models</h1>

<img data-src="imgs/252.svg" class="r-stretch quarto-figure-center"><p class="caption">Taxonomy of storage models <span class="citation" data-cites="mansouri2017data">(<a href="#/references" role="doc-biblioref" onclick="">Mansouri, Toosi, and Buyya 2017</a>)</span></p></section>

<section id="storage-models-aws" class="title-slide slide level1 center">
<h1>Storage models (AWS)</h1>
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: center;"><em>Data structure</em></th>
<th style="text-align: center;"><em>Data abstraction</em></th>
<th style="text-align: center;"><em>Data access</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Structured</td>
<td style="text-align: center;">Database</td>
<td style="text-align: center;">Relational</td>
</tr>
</tbody>
</table>
<p><br></p>
<div class="columns">
<div class="column" style="width:60%;">
<p><strong>Relational database</strong></p>
<ul>
<li>Store data with predefined schemas and relationships between them</li>
<li>Support ACID transactions</li>
<li>Maintain referential integrity</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imgs/253.svg"></p>
<figcaption><a href="https://aws.amazon.com/products/databases/">AWS databases</a></figcaption>
</figure>
</div>
</div></div>
</section>

<section id="storage-models-aws-1" class="title-slide slide level1 center">
<h1>Storage models (AWS)</h1>
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: center;"><em>Data structure</em></th>
<th style="text-align: center;"><em>Data abstraction</em></th>
<th style="text-align: center;"><em>Data access</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Semi/unstructured</td>
<td style="text-align: center;">Database</td>
<td style="text-align: center;">*</td>
</tr>
</tbody>
</table>
<p><br></p>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><strong>Key/value</strong>: store and retrieve large volumes of data</li>
<li><strong>Document</strong>: store semi-structured data as JSON-like documents</li>
<li><strong>Wide column</strong>: use tables but unlike a relational database, columns can vary from row to row in the same table</li>
<li><strong>Graph</strong>: navigate and query relationships between highly connected datasets</li>
<li>… and more</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imgs/254.svg"></p>
<figcaption><a href="https://aws.amazon.com/products/databases/">AWS databases</a></figcaption>
</figure>
</div>
</div></div>
</section>

<section id="storage-models-google-cloud" class="title-slide slide level1 center">
<h1>Storage models (<a href="https://cloud.google.com/products/databases">Google Cloud</a>)</h1>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="imgs/slides188.png"></p>
</div><div class="column" style="width:50%;">
<p><img data-src="imgs/slides189.png"></p>
</div></div>
</section>

<section id="storage-models-aws-2" class="title-slide slide level1 center">
<h1>Storage models (AWS)</h1>
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: center;"><em>Data structure</em></th>
<th style="text-align: center;"><em>Data abstraction</em></th>
<th style="text-align: center;"><em>Data access</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Unstructured</td>
<td style="text-align: center;">File/Database</td>
<td style="text-align: center;">Key-value</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>File system</strong> (EFS), <strong>object storage</strong> (S3) (or <strong>DB K-V</strong> ; e.g., DynamoDB)</p>
<ul>
<li>Handle unstructured data</li>
<li>… organized as files (or blob)</li>
<li>… accessed using a key-value</li>
</ul>
<p><em>Differ in the supported features</em></p>
<ul>
<li>E.g., maximum item size (DynamoDB: 400KB, S3: 5TB)</li>
<li>E.g., indexes, querying mechanisms, latency, etc.</li>
</ul>
</section>

<section id="aws-simple-storage-service-s3" class="title-slide slide level1 center">
<h1>AWS Simple Storage Service (S3)</h1>
<p><strong>Simple Storage Service (S3)</strong></p>
<ul>
<li><em>Serverless</em> storage, save data as <strong>objects</strong> within <strong>buckets</strong></li>
<li>An <strong>object</strong> is composed of a file and any metadata that describes that file (e.g., <strong>object key</strong>)</li>
<li><strong>Buckets</strong> are logical containers for objects
<ul>
<li>You can have one or more buckets in your account</li>
<li>Control access for each bucket individually</li>
<li>Choose the geographical region where Amazon S3 will store the bucket and its contents</li>
</ul></li>
</ul>
<p>Benefits</p>
<ul>
<li>Unified data architecture
<ul>
<li>Build a multi-tenant environment, where many users can bring their data</li>
<li>Improve both cost and data governance over traditional solutions</li>
</ul></li>
<li><em>Decoupling of storage from computing and data processing</em>
<ul>
<li>You can cost-effectively store all data types in their native formats</li>
<li>Then, launch transformations as you need</li>
</ul></li>
</ul>
</section>

<section id="storage-access-frequency-aws" class="title-slide slide level1 center">
<h1>Storage: access frequency (AWS)</h1>
<div class="columns">
<div class="column" style="width:60%;">
<p>AWS S3: <a href="https://aws.amazon.com/s3/storage-classes/">storage classes</a></p>
<ul>
<li><em>Standard</em>: general purpose</li>
<li><em>Infrequent (rapid) access</em></li>
<li><em>One Zone-IA</em>: lower-cost option for infrequently accessed data that do not require high availability and resilience</li>
<li><em>Glacier</em>: low-cost storage class for data archiving, three retrieval options that range from a few minutes to hours</li>
<li><em>Deep Glacier</em>: long-term retention for data accessed once/twice a year.
<ul>
<li>E.g., retain data sets for 10 years or longer</li>
</ul></li>
<li><em>Intelligent-Tiering</em>: move objects between access tiers when access patterns change</li>
</ul>
</div><div class="column" style="width:40%;">
<p><img data-src="imgs/258.svg"></p>
</div></div>
</section>

<section id="storage-access-frequency-aws-1" class="title-slide slide level1 center">
<h1>Storage: access frequency (AWS)</h1>
<div class="columns">
<div class="column" style="width:60%;">
<p><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html">Object lifecycle management</a></p>
<ul>
<li>Rules that define actions that Amazon S3 applies to a group of objects</li>
</ul>
<p>Two types of actions:</p>
<ul>
<li><em>Transition</em>: when objects transition to another storage class.
<ul>
<li>E.g., archive objects to the S3 Glacier storage 1 year after creating them</li>
</ul></li>
<li><em>Expiration</em>: when objects expire.
<ul>
<li>Amazon S3 deletes expired objects on your behalf</li>
</ul></li>
</ul>
</div><div class="column" style="width:40%;">
<p><img data-src="imgs/259.svg"></p>
</div></div>
</section>

<section id="storage-access-frequency-google-cloud" class="title-slide slide level1 center">
<h1>Storage: access frequency (<a href="https://cloud.google.com/blog/products/storage-data-transfer/archive-storage-class-for-coldest-data-now-available">Google Cloud</a>)</h1>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="imgs/slides192.png"></p>
</div><div class="column" style="width:50%;">
<p><img data-src="imgs/slides193.png"></p>
</div></div>
</section>

<section id="organizing-the-data-lake" class="title-slide slide level1 center">
<h1>Organizing the data lake</h1>

</section>

<section id="organizing-the-data-lake-1" class="title-slide slide level1 center">
<h1>Organizing the data lake</h1>
<div class="columns">
<div class="column" style="width:60%;">
<p>Having consistent principles on how to organize your data is important</p>
<ul>
<li>To build standardized pipelines with the same design with regard to where read/write data</li>
<li>Standardization makes it easier to manage your pipelines at scale</li>
<li>Helps data users search for data in the storage and understand exactly what they need</li>
<li>Decoupling storage from processing</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imgs/261.svg"></p>
<figcaption>Areas</figcaption>
</figure>
</div>
</div></div>
</section>

<section id="organizing-the-data-lake-2" class="title-slide slide level1 center">
<h1>Organizing the data lake</h1>
<div class="columns">
<div class="column" style="width:60%;">
<p><strong>Landing area (LA)</strong></p>
<ul>
<li>Save <em>raw data</em> from ingestion</li>
<li>Transient, data is not stored for long term</li>
</ul>
<p><strong>Staging area (SA)</strong></p>
<ul>
<li>Raw data goes through a set of common transformations: ensuring <em>basic quality</em> and making sure it <em>conforms to existing schemas</em> for this data source and then data is saved into SA</li>
</ul>
<p><strong>Archive area (AA)</strong></p>
<ul>
<li>After saving into SA, raw data from LA should be <em>copied into the archive</em> to reprocess any given batch of data by simply copying it from AA into LA</li>
<li>Useful for debugging and testing</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imgs/262.svg"></p>
<figcaption>Areas</figcaption>
</figure>
</div>
</div></div>
</section>

<section id="organizing-the-data-lake-3" class="title-slide slide level1 center">
<h1>Organizing the data lake</h1>
<div class="columns">
<div class="column" style="width:60%;">
<p><strong>Production area (PA)</strong></p>
<ul>
<li>Apply the business logic to data from SA</li>
</ul>
<p><strong>Pass-through job</strong></p>
<ul>
<li>Copy data from SA to PA and then into DWH without applying any business logic</li>
<li>Having a data set in the data warehouse and PA that is a replica can be helpful when debugging any issues with the business logic</li>
</ul>
<p><strong>Cloud data warehouse (DWH)</strong></p>
<p><strong>Failed area (FA)</strong></p>
<ul>
<li>You need to be able to deal with all kinds of errors and failures</li>
<li>There might be bugs in the pipeline code, and cloud resources may fail</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imgs/263.svg"></p>
<figcaption>Areas</figcaption>
</figure>
</div>
</div></div>
</section>

<section id="organizing-the-data-lake-4" class="title-slide slide level1 center">
<h1>Organizing the data lake</h1>
<table class="caption-top">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Area</th>
<th style="text-align: center;">Permissions</th>
<th style="text-align: center;">Tier</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Landing</td>
<td style="text-align: center;">Ingestion applications can write<br>Scheduled pipelines can read<br>Data consumers can’t access</td>
<td style="text-align: center;"><strong>Hot</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;">Staging</td>
<td style="text-align: center;">Scheduled pipelines can read/write<br>Selected data consumers can read</td>
<td style="text-align: center;"><strong>Hot</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Production</td>
<td style="text-align: center;">Scheduled pipelines can read/write<br>Selected data consumers can read</td>
<td style="text-align: center;"><strong>Hot</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;">Archive</td>
<td style="text-align: center;">Scheduled pipelines can write<br>Dedicated data reprocessing pipelines can read</td>
<td style="text-align: center;"><em>Cold</em>/<em>Archive</em></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Failed</td>
<td style="text-align: center;">Scheduled pipelines can write<br>Dedicated data reprocessing pipelines can read<br>Data consumers don’t have access</td>
<td style="text-align: center;"><strong>Hot</strong></td>
</tr>
</tbody>
</table>
</section>

<section id="organizing-the-data-lake-5" class="title-slide slide level1 center">
<h1>Organizing the data lake</h1>
<p>Alternative organizations are available</p>
<div class="columns">
<div class="column" style="width:60%;">
<blockquote>
<p>“A data lake is a central repository system for storage, processing, and analysis of raw data, in which the data is <strong>kept in its original format </strong> and is processed to be queried only when needed. It can store a <strong>varied amount of formats </strong> in big data ecosystems, from unstructured, semi-structured, to structured data sources.”</p>
<p><span class="citation" data-cites="couto2019mapping">(<a href="#/references" role="doc-biblioref" onclick="">Couto et al. 2019</a>)</span></p>
</blockquote>
</div><div class="column" style="width:40%;">
<p><img data-src="imgs/266.svg"></p>
</div></div>
</section>

<section id="organizing-the-data-lake-6" class="title-slide slide level1 center">
<h1>Organizing the data lake</h1>
<p>Use folders to organize data inside areas into a logical structure</p>
<ul>
<li><em>Namespace</em>
<ul>
<li>Logically group multiple pipelines together.</li>
</ul></li>
<li><em>Pipeline name</em>
<ul>
<li>Each data pipeline should have a name that reflects its purpose. For example
<ul>
<li>A pipeline that takes data from the LA, applies common processing steps, and saves data into SA</li>
<li>You will also have one for archiving data into AA</li>
</ul></li>
</ul></li>
<li><em>Data source name</em>
<ul>
<li>The ingestion layer will assign a name to each data source you bring into the platform</li>
</ul></li>
<li><em>BatchId</em>
<ul>
<li>Unique identifier for any batch of data that is saved into LA</li>
<li>E.g., Since only ingestion can write to LA, it is its responsibility to generate this identifier</li>
<li>A common choice for this type of identifier is a Universally Unique Identifier (UUID)</li>
</ul></li>
</ul>
<p>Different areas will have slightly different folder structures</p>
<ul>
<li>/landing/ETL/sales_oracle_ingest/customers/01DFTFX89YDFAXREPJTR94</li>
</ul>
</section>

<section id="data-lakehouse" class="title-slide slide level1 center">
<h1>Data Lakehouse</h1>

</section>

<section id="data-lakehouse-1" class="title-slide slide level1 center">
<h1>Data Lakehouse</h1>
<p>Combine the key benefits of data lakes and data warehouses</p>
<ul>
<li>Low-cost storage in an open format accessible by a variety of systems from the former</li>
<li>Powerful management and optimization features from the latter
<ul>
<li>ACID transactions, data versioning, auditing, indexing, caching, and query optimization.</li>
</ul></li>
</ul>
<p><em>Key question: can we effectively combine these benefits?</em></p>
<ul>
<li><strong>Lakehouses</strong> are a good fit for cloud environments with separate computing and storage</li>
<li>Applications can run on-demand on separate computing nodes while accessing data in storage nodes</li>
</ul>
</section>

<section id="data-independence" class="title-slide slide level1 center">
<h1>Data Independence</h1>
<div class="columns">
<div class="column" style="width:60%;">
<p><strong>Data independence</strong>: modify the schema at one level of the database system without altering the schema at the next higher level</p>
<ul>
<li>It can be explained using the three-schema architecture</li>
</ul>
</div><div class="column" style="width:40%;">
<p><img data-src="imgs/slides194.png"></p>
</div></div>
</section>

<section id="data-lakehouse-armbrust2021lakehouse" class="title-slide slide level1 center">
<h1>Data Lakehouse <span class="citation" data-cites="armbrust2021lakehouse">(<a href="#/references" role="doc-biblioref" onclick="">Armbrust et al. 2021</a>)</span></h1>

<img data-src="imgs/slides195.png" class="r-stretch quarto-figure-center"><p class="caption">From DWH to Data Lakehouse</p></section>

<section id="data-lakehouse-armbrust2021lakehouse-1" class="title-slide slide level1 center">
<h1>Data Lakehouse <span class="citation" data-cites="armbrust2021lakehouse">(<a href="#/references" role="doc-biblioref" onclick="">Armbrust et al. 2021</a>)</span></h1>
<p><strong>1st generation systems</strong>: data warehousing started with helping business decision-makers get analytical insights</p>
<ul>
<li>Data in warehouses (DWH) would be written with <em>schema-on-write</em> to ensure that data is optimized for BI applications
<ul>
<li><em>Schema on write</em> is defined as creating a schema for data before writing into the database</li>
</ul></li>
<li>Several challenges
<ul>
<li>DWH typically couples compute and storage into an on-premises appliance
<ul>
<li>This forced enterprises to provision and pay for the peak of user load and data under management, which is very costly</li>
</ul></li>
<li>More and more datasets were completely unstructured, which DWHs could not store and query at all</li>
</ul></li>
</ul>
</section>

<section id="data-lakehouse-armbrust2021lakehouse-2" class="title-slide slide level1 center">
<h1>Data Lakehouse <span class="citation" data-cites="armbrust2021lakehouse">(<a href="#/references" role="doc-biblioref" onclick="">Armbrust et al. 2021</a>)</span></h1>
<p><strong>2nd generation</strong>: offloading all the raw data into data lakes</p>
<ul>
<li>The data lake is <em>schema-on-read</em> and stores any data at low cost
<ul>
<li><em>Schema on read</em> postpones the structuring of data to the time of analysis or reading</li>
</ul></li>
<li>From 2015 onwards, cloud data lakes, such as S3 and GCS, started replacing HDFS
<ul>
<li>Superior durability (often &gt;10 nines), geo-replication, and most importantly, extremely low cost</li>
</ul></li>
<li>The use of <em>open formats</em> also made data lake data directly accessible to a wide range of other analytics engines, such as machine learning systems
<ul>
<li>An <em>open file format</em> is a file format for storing digital data, defined by an openly published specification usually maintained by a standards organization, and which can be used and implemented by anyone.</li>
</ul></li>
<li>A small subset of data in the lake would later be ETLed to a downstream data warehouse
<ul>
<li><em>Problems</em>?</li>
</ul></li>
</ul>
</section>

<section id="data-lakehouse-2" class="title-slide slide level1 center">
<h1>Data Lakehouse</h1>
<p>A two-tier architecture is highly complex for users</p>
<ul>
<li>(Optional) Data is first <em>ETLed</em> into lakes, …</li>
<li>… and then <em>ELTed</em> into warehouses</li>
<li>Enterprise use cases now include advanced analytics such as machine learning, for which warehouses are not ideal</li>
</ul>
<p>(Some) main problems:</p>
<ul>
<li><em>Reliability</em>: keeping the data lake and warehouse consistent is difficult and costly</li>
<li><em>Staleness</em>: the data in the warehouse is stale compared to that of the data lake, with new data frequently taking days to load</li>
<li><em>Limited support for advanced analytics</em>: businesses want to ask predictive questions using their warehousing data
<ul>
<li>E.g., “Which customers should I offer discounts to?”</li>
<li>E.g., process large datasets using complex non-SQL code</li>
</ul></li>
<li>It could require <em>two teams of users</em>: data scientists and BI</li>
</ul>
</section>

<section id="data-lakehouse-3" class="title-slide slide level1 center">
<h1>Data Lakehouse</h1>
<div class="columns">
<div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imgs/hypecycle-dm-2022.png"></p>
<figcaption>2022</figcaption>
</figure>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imgs/hypecycle-dm-2024.png"></p>
<figcaption>2024</figcaption>
</figure>
</div>
</div></div>
<p>The market is pushing for the adoption of Lakehouse as a standard <em>de facto</em></p>
</section>

<section id="dataset-search-for-data-discovery-augmentation-and-explanation" class="title-slide slide level1 center">
<h1>Dataset Search for Data Discovery, Augmentation, and Explanation</h1>
<p><strong>Is there a real need for many unstructured and integrated datasets?</strong></p>
<ul>
<li>Recent years have seen an explosion in our ability to collect and catalog data about our environment and society</li>
<li>Governments and organizations are increasingly making data available on the Web and in various repositories and data lakes</li>
<li><em>This opportunity is often missed due to a central technical barrier</em>: it is currently nearly impossible for domain experts to weed through the vast amount of available information to discover datasets that are needed for their specific application</li>
</ul>
<p>Juliana Freire, keynote @ EDBT 2023</p>
</section>

<section id="data-lakehouse-4" class="title-slide slide level1 center">
<h1>Data Lakehouse</h1>
<p>Idea</p>
<ul>
<li><em>Store data in a low-cost object store</em> using an open file format such as Apache Parquet</li>
<li><em>Implement a transactional metadata layer</em> on top of the object store that defines which objects are part of a table version</li>
<li><em>Implement management features</em> within the metadata layer</li>
</ul>

<img data-src="imgs/slides196.png" class="r-stretch quarto-figure-center"><p class="caption">Lakehouse</p></section>

<section id="data-lakehouse-5" class="title-slide slide level1 center">
<h1>Data Lakehouse</h1>
<p>Metadata alone is insufficient to achieve good performance, challenges:</p>
<ul>
<li><em>Data warehouses use several techniques to get state-of-the-art performance</em>
<ul>
<li>Storing hot data on fast devices such as SSDs, maintaining statistics, building efficient indexes, etc.</li>
</ul></li>
<li>Most <em>data lakes (cloud object stores) are merely key-value stores</em>, with no cross-key consistency
<ul>
<li><em>Multi-object updates are not atomic</em>, there is no isolation between queries
<ul>
<li>If a query updates multiple objects in a table, readers will see partial updates as the query updates each object individually</li>
</ul></li>
</ul></li>
<li>In <em>data lakes</em> it is possible to implement other optimizations that leave the data files unchanged
<ul>
<li>For large tables with millions of objects, <em>metadata operations are expensive</em></li>
<li>The latency of cloud object stores is so much higher that these data-skipping checks can take longer than the actual query</li>
</ul></li>
</ul>
</section>

<section id="delta-lake-armbrust2020delta" class="title-slide slide level1 center">
<h1>Delta Lake <span class="citation" data-cites="armbrust2020delta">(<a href="#/references" role="doc-biblioref" onclick="">Armbrust et al. 2020</a>)</span></h1>
<div class="columns">
<div class="column" style="width:50%;">
<p>Delta Lake uses a <strong>transaction log</strong> and stores data into Apache Parquet for significantly faster metadata operations for large tabular datasets</p>
<ul>
<li>E.g., quickly search billions of table partitions</li>
<li>The log is stored in the <code>_delta_log</code> subdirectory</li>
<li>The delta log contains
<ul>
<li>Sequence of <em>commits</em> JSON objects with increasing, zero-padded numerical IDs to store the log records</li>
<li>Occasional <em>checkpoints</em> for specific log objects that summarize the log up to that point</li>
</ul></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imgs/deltalake1.png"></p>
<figcaption><a href="https://www.databricks.com/blog/2019/08/21/diving-into-delta-lake-unpacking-the-transaction-log.html">Delta Lake transaction log</a></figcaption>
</figure>
</div>
</div></div>
</section>

<section id="delta-lake" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p>Changes are recorded as ordered, atomic commits in the transaction log.</p>
<ul>
<li>Each commit is written as a JSON file, starting with <code>000000.json</code>.</li>
<li>Additional changes to the table generate subsequent JSON files in ascending numerical order</li>
<li>Each log record object (e.g., <code>000003.json</code>) contains an array of actions to apply to the previous table version</li>
</ul>
<p>Whenever a user modifies a table (such as an INSERT, UPDATE, or DELETE), Delta Lake breaks that operation down into a series of discrete steps composed of one or more of the actions below.</p>
<ul>
<li><em>Add file</em>: adds a data file.</li>
<li><em>Remove file</em>: removes a data file.</li>
<li><em>Update metadata</em>: Updates the table’s metadata (e.g., changing the table’s name, schema, or partitioning).</li>
<li><em>Set transaction</em>: Records that a structured streaming job has committed a micro-batch with the given ID.</li>
<li><em>Change protocol</em>: enables new features by switching the Delta Lake transaction log to the newest software protocol.</li>
<li><em>Commit info</em>: Contains information around the commit, which operation was made, from where, and when.</li>
</ul>
</section>

<section id="delta-lake-1" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p><em>You own your data</em>: we are decoupling the data from database engines!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource sql number-lines"><code class="sourceCode sql"><span id="cb1-1"><a href=""></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> suppliers(<span class="kw">id</span> <span class="dt">INT</span>, name STRING, age <span class="dt">INT</span>)</span>
<span id="cb1-2"><a href=""></a> TBLPROPERTIES (<span class="st">'foo'</span><span class="op">=</span><span class="st">'bar'</span>)</span>
<span id="cb1-3"><a href=""></a> <span class="kw">COMMENT</span> <span class="st">'this is a comment'</span></span>
<span id="cb1-4"><a href=""></a>    LOCATION <span class="st">'s3://...'</span>;</span></code></pre></div>
<p>Delta tables are stored in S3 (simple files in a data lake), and they can be read using <em>different computes</em>:</p>
<ul>
<li>Databricks, EMR, etc.</li>
<li>Otherwise you are locked in with the vendor (e.g., Oracle).</li>
</ul>
<p>… and <em>languages</em></p>
<ul>
<li>Python, SQL, etc.</li>
</ul>
</section>

<section id="delta-lake-2" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p>Create a table of <code>suppliers</code>, the content of <code>00000000000000000000.json</code></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource json number-lines"><code class="sourceCode json"><span id="cb2-1"><a href=""></a><span class="fu">{</span></span>
<span id="cb2-2"><a href=""></a>    <span class="dt">"commitInfo"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-3"><a href=""></a>        <span class="dt">"timestamp"</span><span class="fu">:</span> <span class="dv">1709133408152</span><span class="fu">,</span></span>
<span id="cb2-4"><a href=""></a>        <span class="dt">"userId"</span><span class="fu">:</span> <span class="st">"8355321721036096"</span><span class="fu">,</span></span>
<span id="cb2-5"><a href=""></a>        <span class="dt">"userName"</span><span class="fu">:</span> <span class="st">"user1@foo.bar"</span><span class="fu">,</span></span>
<span id="cb2-6"><a href=""></a>        <span class="dt">"operation"</span><span class="fu">:</span> <span class="st">"CREATE TABLE AS SELECT"</span><span class="fu">,</span></span>
<span id="cb2-7"><a href=""></a>        <span class="dt">"operationParameters"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-8"><a href=""></a>            <span class="dt">"partitionBy"</span><span class="fu">:</span> <span class="st">"[]"</span><span class="fu">,</span></span>
<span id="cb2-9"><a href=""></a>            <span class="dt">"description"</span><span class="fu">:</span> <span class="kw">null</span><span class="fu">,</span></span>
<span id="cb2-10"><a href=""></a>            <span class="dt">"isManaged"</span><span class="fu">:</span> <span class="st">"false"</span><span class="fu">,</span></span>
<span id="cb2-11"><a href=""></a>            <span class="dt">"properties"</span><span class="fu">:</span> <span class="st">"{}"</span><span class="fu">,</span></span>
<span id="cb2-12"><a href=""></a>            <span class="dt">"statsOnLoad"</span><span class="fu">:</span> <span class="kw">false</span></span>
<span id="cb2-13"><a href=""></a> <span class="fu">},</span></span>
<span id="cb2-14"><a href=""></a>        <span class="dt">"notebook"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-15"><a href=""></a>            <span class="dt">"notebookId"</span><span class="fu">:</span> <span class="st">"68312033830310"</span></span>
<span id="cb2-16"><a href=""></a> <span class="fu">},</span></span>
<span id="cb2-17"><a href=""></a>        <span class="dt">"clusterId"</span><span class="fu">:</span> <span class="st">"0112-095737-cgwksnoz"</span><span class="fu">,</span></span>
<span id="cb2-18"><a href=""></a>        <span class="dt">"isolationLevel"</span><span class="fu">:</span> <span class="st">"WriteSerializable"</span><span class="fu">,</span></span>
<span id="cb2-19"><a href=""></a>        <span class="dt">"isBlindAppend"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb2-20"><a href=""></a>        <span class="dt">"operationMetrics"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-21"><a href=""></a>            <span class="dt">"numFiles"</span><span class="fu">:</span> <span class="st">"4"</span><span class="fu">,</span></span>
<span id="cb2-22"><a href=""></a>            <span class="dt">"numOutputRows"</span><span class="fu">:</span> <span class="st">"1000000"</span><span class="fu">,</span></span>
<span id="cb2-23"><a href=""></a>            <span class="dt">"numOutputBytes"</span><span class="fu">:</span> <span class="st">"79811576"</span></span>
<span id="cb2-24"><a href=""></a> <span class="fu">},</span></span>
<span id="cb2-25"><a href=""></a>        <span class="dt">"tags"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-26"><a href=""></a>            <span class="dt">"restoresDeletedRows"</span><span class="fu">:</span> <span class="st">"false"</span></span>
<span id="cb2-27"><a href=""></a> <span class="fu">},</span></span>
<span id="cb2-28"><a href=""></a>        <span class="dt">"engineInfo"</span><span class="fu">:</span> <span class="st">"Databricks-Runtime/13.3.x-scala2.12"</span><span class="fu">,</span></span>
<span id="cb2-29"><a href=""></a>        <span class="dt">"txnId"</span><span class="fu">:</span> <span class="st">"afc094e5-7096-40cb-b4f7-33e98c5d3a4b"</span></span>
<span id="cb2-30"><a href=""></a> <span class="fu">}</span></span>
<span id="cb2-31"><a href=""></a><span class="fu">}</span></span></code></pre></div>
</div><div class="column" style="width:50%;">
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource json number-lines"><code class="sourceCode json"><span id="cb3-1"><a href=""></a><span class="fu">{</span></span>
<span id="cb3-2"><a href=""></a>    <span class="dt">"add"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-3"><a href=""></a>        <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"part-00000-d7654bfc-8169-41a7-a7fc-28586c8f73f9-c000.snappy.parquet"</span><span class="fu">,</span></span>
<span id="cb3-4"><a href=""></a>        <span class="dt">"partitionValues"</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb3-5"><a href=""></a>        <span class="dt">"size"</span><span class="fu">:</span> <span class="dv">20588082</span><span class="fu">,</span></span>
<span id="cb3-6"><a href=""></a>        <span class="dt">"modificationTime"</span><span class="fu">:</span> <span class="dv">1709133407000</span><span class="fu">,</span></span>
<span id="cb3-7"><a href=""></a>        <span class="dt">"dataChange"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb3-8"><a href=""></a>        <span class="dt">"stats"</span><span class="fu">:</span> <span class="st">"{</span><span class="ch">\"</span><span class="st">numRecords</span><span class="ch">\"</span><span class="st">:257994,</span><span class="ch">\"</span><span class="st">minValues</span><span class="ch">\"</span><span class="st">:{</span><span class="ch">\"</span><span class="st">s_suppkey</span><span class="ch">\"</span><span class="st">:1,</span><span class="ch">\"</span><span class="st">s_name</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">Supplier#000000001</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_address</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st"> , Jd6qNPDAgz</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_nationkey</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_phone</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">10-100-166-6237</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_acctbal</span><span class="ch">\"</span><span class="st">:-999.94,</span><span class="ch">\"</span><span class="st">s_comment</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st"> Customer  blithely regular pint</span><span class="ch">\"</span><span class="st">},</span><span class="ch">\"</span><span class="st">maxValues</span><span class="ch">\"</span><span class="st">:{</span><span class="ch">\"</span><span class="st">s_suppkey</span><span class="ch">\"</span><span class="st">:257994,</span><span class="ch">\"</span><span class="st">s_name</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">Supplier#000257994</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_address</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">zzyv9d9xGUF QcjHQG8gDjuLo pLBxBZ�</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_nationkey</span><span class="ch">\"</span><span class="st">:24,</span><span class="ch">\"</span><span class="st">s_phone</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">34-999-987-5257</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_acctbal</span><span class="ch">\"</span><span class="st">:9999.93,</span><span class="ch">\"</span><span class="st">s_comment</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">zzle. sometimes bold pinto beans�</span><span class="ch">\"</span><span class="st">},</span><span class="ch">\"</span><span class="st">nullCount</span><span class="ch">\"</span><span class="st">:{</span><span class="ch">\"</span><span class="st">s_suppkey</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_name</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_address</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_nationkey</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_phone</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_acctbal</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_comment</span><span class="ch">\"</span><span class="st">:0}}"</span><span class="fu">,</span></span>
<span id="cb3-9"><a href=""></a>        <span class="dt">"tags"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-10"><a href=""></a>            <span class="dt">"INSERTION_TIME"</span><span class="fu">:</span> <span class="st">"1709133407000000"</span><span class="fu">,</span></span>
<span id="cb3-11"><a href=""></a>            <span class="dt">"MIN_INSERTION_TIME"</span><span class="fu">:</span> <span class="st">"1709133407000000"</span><span class="fu">,</span></span>
<span id="cb3-12"><a href=""></a>            <span class="dt">"MAX_INSERTION_TIME"</span><span class="fu">:</span> <span class="st">"1709133407000000"</span><span class="fu">,</span></span>
<span id="cb3-13"><a href=""></a>            <span class="dt">"OPTIMIZE_TARGET_SIZE"</span><span class="fu">:</span> <span class="st">"268435456"</span></span>
<span id="cb3-14"><a href=""></a> <span class="fu">}</span></span>
<span id="cb3-15"><a href=""></a> <span class="fu">}</span></span>
<span id="cb3-16"><a href=""></a><span class="fu">}</span></span>
<span id="cb3-17"><a href=""></a><span class="fu">{</span></span>
<span id="cb3-18"><a href=""></a>    <span class="dt">"add"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-19"><a href=""></a>        <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"part-00001-758ed86b-1400-46b8-b73f-50c6ad4324f1-c000.snappy.parquet"</span><span class="fu">,</span></span>
<span id="cb3-20"><a href=""></a>        <span class="dt">"partitionValues"</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb3-21"><a href=""></a>        <span class="dt">"size"</span><span class="fu">:</span> <span class="dv">20516343</span><span class="fu">,</span></span>
<span id="cb3-22"><a href=""></a>        <span class="dt">"modificationTime"</span><span class="fu">:</span> <span class="dv">1709133408000</span><span class="fu">,</span></span>
<span id="cb3-23"><a href=""></a>        <span class="dt">"dataChange"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb3-24"><a href=""></a>        <span class="dt">"stats"</span><span class="fu">:</span> <span class="st">"{</span><span class="ch">\"</span><span class="st">numRecords</span><span class="ch">\"</span><span class="st">:257111,</span><span class="ch">\"</span><span class="st">minValues</span><span class="ch">\"</span><span class="st">:{</span><span class="ch">\"</span><span class="st">s_suppkey</span><span class="ch">\"</span><span class="st">:257995,</span><span class="ch">\"</span><span class="st">s_name</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">Supplier#000257995</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_address</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st"> t2HGWJzQQcWUyx</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_nationkey</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_phone</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">10-100-154-1322</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_acctbal</span><span class="ch">\"</span><span class="st">:-999.96,</span><span class="ch">\"</span><span class="st">s_comment</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st"> Customer  blithe requesComplain</span><span class="ch">\"</span><span class="st">},</span><span class="ch">\"</span><span class="st">maxValues</span><span class="ch">\"</span><span class="st">:{</span><span class="ch">\"</span><span class="st">s_suppkey</span><span class="ch">\"</span><span class="st">:515105,</span><span class="ch">\"</span><span class="st">s_name</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">Supplier#000515105</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_address</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">zzyvSACyGWpp5gCaZbUL7lKRUnhe7m6p�</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_nationkey</span><span class="ch">\"</span><span class="st">:24,</span><span class="ch">\"</span><span class="st">s_phone</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">34-999-802-1817</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_acctbal</span><span class="ch">\"</span><span class="st">:9999.95,</span><span class="ch">\"</span><span class="st">s_comment</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">zzle. regular foxes are ironic p�</span><span class="ch">\"</span><span class="st">},</span><span class="ch">\"</span><span class="st">nullCount</span><span class="ch">\"</span><span class="st">:{</span><span class="ch">\"</span><span class="st">s_suppkey</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_name</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_address</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_nationkey</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_phone</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_acctbal</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_comment</span><span class="ch">\"</span><span class="st">:0}}"</span><span class="fu">,</span></span>
<span id="cb3-25"><a href=""></a>        <span class="dt">"tags"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-26"><a href=""></a>            <span class="dt">"INSERTION_TIME"</span><span class="fu">:</span> <span class="st">"1709133407000001"</span><span class="fu">,</span></span>
<span id="cb3-27"><a href=""></a>            <span class="dt">"MIN_INSERTION_TIME"</span><span class="fu">:</span> <span class="st">"1709133407000001"</span><span class="fu">,</span></span>
<span id="cb3-28"><a href=""></a>            <span class="dt">"MAX_INSERTION_TIME"</span><span class="fu">:</span> <span class="st">"1709133407000001"</span><span class="fu">,</span></span>
<span id="cb3-29"><a href=""></a>            <span class="dt">"OPTIMIZE_TARGET_SIZE"</span><span class="fu">:</span> <span class="st">"268435456"</span></span>
<span id="cb3-30"><a href=""></a> <span class="fu">}</span></span>
<span id="cb3-31"><a href=""></a> <span class="fu">}</span></span>
<span id="cb3-32"><a href=""></a><span class="fu">}</span></span></code></pre></div>
</div></div>
</section>

<section id="delta-lake-3" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p>Add a new <code>supplier</code>, content of <code>00000000000000000009.json</code></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource json number-lines"><code class="sourceCode json"><span id="cb4-1"><a href=""></a><span class="fu">{</span></span>
<span id="cb4-2"><a href=""></a>    <span class="dt">"commitInfo"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-3"><a href=""></a>        <span class="dt">"timestamp"</span><span class="fu">:</span> <span class="dv">1709134798441</span><span class="fu">,</span></span>
<span id="cb4-4"><a href=""></a>        <span class="dt">"userId"</span><span class="fu">:</span> <span class="st">"8047431628735957"</span><span class="fu">,</span></span>
<span id="cb4-5"><a href=""></a>        <span class="dt">"userName"</span><span class="fu">:</span> <span class="st">"user2@foo.bar"</span><span class="fu">,</span></span>
<span id="cb4-6"><a href=""></a>        <span class="dt">"operation"</span><span class="fu">:</span> <span class="st">"WRITE"</span><span class="fu">,</span></span>
<span id="cb4-7"><a href=""></a>        <span class="dt">"operationParameters"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-8"><a href=""></a>            <span class="dt">"mode"</span><span class="fu">:</span> <span class="st">"Append"</span><span class="fu">,</span></span>
<span id="cb4-9"><a href=""></a>            <span class="dt">"statsOnLoad"</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb4-10"><a href=""></a>            <span class="dt">"partitionBy"</span><span class="fu">:</span> <span class="st">"[]"</span></span>
<span id="cb4-11"><a href=""></a> <span class="fu">},</span></span>
<span id="cb4-12"><a href=""></a>        <span class="dt">"notebook"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-13"><a href=""></a>            <span class="dt">"notebookId"</span><span class="fu">:</span> <span class="st">"4471242088384584"</span></span>
<span id="cb4-14"><a href=""></a> <span class="fu">},</span></span>
<span id="cb4-15"><a href=""></a>        <span class="dt">"clusterId"</span><span class="fu">:</span> <span class="st">"0112-095737-cgwksnoz"</span><span class="fu">,</span></span>
<span id="cb4-16"><a href=""></a>        <span class="dt">"readVersion"</span><span class="fu">:</span> <span class="dv">8</span><span class="fu">,</span></span>
<span id="cb4-17"><a href=""></a>        <span class="dt">"isolationLevel"</span><span class="fu">:</span> <span class="st">"WriteSerializable"</span><span class="fu">,</span></span>
<span id="cb4-18"><a href=""></a>        <span class="dt">"isBlindAppend"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb4-19"><a href=""></a>        <span class="dt">"operationMetrics"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-20"><a href=""></a>            <span class="dt">"numFiles"</span><span class="fu">:</span> <span class="st">"1"</span><span class="fu">,</span></span>
<span id="cb4-21"><a href=""></a>            <span class="dt">"numOutputRows"</span><span class="fu">:</span> <span class="st">"1"</span><span class="fu">,</span></span>
<span id="cb4-22"><a href=""></a>            <span class="dt">"numOutputBytes"</span><span class="fu">:</span> <span class="st">"2675"</span></span>
<span id="cb4-23"><a href=""></a> <span class="fu">},</span></span>
<span id="cb4-24"><a href=""></a>        <span class="dt">"tags"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-25"><a href=""></a>            <span class="dt">"restoresDeletedRows"</span><span class="fu">:</span> <span class="st">"false"</span></span>
<span id="cb4-26"><a href=""></a> <span class="fu">},</span></span>
<span id="cb4-27"><a href=""></a>        <span class="dt">"engineInfo"</span><span class="fu">:</span> <span class="st">"Databricks-Runtime/13.3.x-scala2.12"</span><span class="fu">,</span></span>
<span id="cb4-28"><a href=""></a>        <span class="dt">"txnId"</span><span class="fu">:</span> <span class="st">"45786330-12ee-4e73-85ff-38cdd2caffcf"</span></span>
<span id="cb4-29"><a href=""></a> <span class="fu">}</span></span>
<span id="cb4-30"><a href=""></a><span class="fu">}</span></span></code></pre></div>
</div><div class="column" style="width:50%;">
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource json number-lines"><code class="sourceCode json"><span id="cb5-1"><a href=""></a><span class="fu">{</span></span>
<span id="cb5-2"><a href=""></a>    <span class="dt">"add"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb5-3"><a href=""></a>        <span class="dt">"path"</span><span class="fu">:</span> <span class="st">"part-00000-7b0e114f-e86f-4952-a030-b877001f8074-c000.snappy.parquet"</span><span class="fu">,</span></span>
<span id="cb5-4"><a href=""></a>        <span class="dt">"partitionValues"</span><span class="fu">:</span> <span class="fu">{},</span></span>
<span id="cb5-5"><a href=""></a>        <span class="dt">"size"</span><span class="fu">:</span> <span class="dv">2675</span><span class="fu">,</span></span>
<span id="cb5-6"><a href=""></a>        <span class="dt">"modificationTime"</span><span class="fu">:</span> <span class="dv">1709134799000</span><span class="fu">,</span></span>
<span id="cb5-7"><a href=""></a>        <span class="dt">"dataChange"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb5-8"><a href=""></a>        <span class="dt">"stats"</span><span class="fu">:</span> <span class="st">"{</span><span class="ch">\"</span><span class="st">numRecords</span><span class="ch">\"</span><span class="st">:1,</span><span class="ch">\"</span><span class="st">minValues</span><span class="ch">\"</span><span class="st">:{</span><span class="ch">\"</span><span class="st">s_suppkey</span><span class="ch">\"</span><span class="st">:1,</span><span class="ch">\"</span><span class="st">s_name</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">Supplier#000000001</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_address</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st"> N kD4on9OM Ipw3,gf0JBoQDd7tgrzr</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_nationkey</span><span class="ch">\"</span><span class="st">:17,</span><span class="ch">\"</span><span class="st">s_phone</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">27-918-335-1736</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_acctbal</span><span class="ch">\"</span><span class="st">:5755.94,</span><span class="ch">\"</span><span class="st">s_comment</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">each slyly above the careful</span><span class="ch">\"</span><span class="st">},</span><span class="ch">\"</span><span class="st">maxValues</span><span class="ch">\"</span><span class="st">:{</span><span class="ch">\"</span><span class="st">s_suppkey</span><span class="ch">\"</span><span class="st">:1,</span><span class="ch">\"</span><span class="st">s_name</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">Supplier#000000001</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_address</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st"> N kD4on9OM Ipw3,gf0JBoQDd7tgrzr�</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_nationkey</span><span class="ch">\"</span><span class="st">:17,</span><span class="ch">\"</span><span class="st">s_phone</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">27-918-335-1736</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">s_acctbal</span><span class="ch">\"</span><span class="st">:5755.94,</span><span class="ch">\"</span><span class="st">s_comment</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">each slyly above the careful</span><span class="ch">\"</span><span class="st">},</span><span class="ch">\"</span><span class="st">nullCount</span><span class="ch">\"</span><span class="st">:{</span><span class="ch">\"</span><span class="st">s_suppkey</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_name</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_address</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_nationkey</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_phone</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_acctbal</span><span class="ch">\"</span><span class="st">:0,</span><span class="ch">\"</span><span class="st">s_comment</span><span class="ch">\"</span><span class="st">:0}}"</span><span class="fu">,</span></span>
<span id="cb5-9"><a href=""></a>        <span class="dt">"tags"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb5-10"><a href=""></a>            <span class="dt">"INSERTION_TIME"</span><span class="fu">:</span> <span class="st">"1709134799000000"</span><span class="fu">,</span></span>
<span id="cb5-11"><a href=""></a>            <span class="dt">"MIN_INSERTION_TIME"</span><span class="fu">:</span> <span class="st">"1709134799000000"</span><span class="fu">,</span></span>
<span id="cb5-12"><a href=""></a>            <span class="dt">"MAX_INSERTION_TIME"</span><span class="fu">:</span> <span class="st">"1709134799000000"</span><span class="fu">,</span></span>
<span id="cb5-13"><a href=""></a>            <span class="dt">"OPTIMIZE_TARGET_SIZE"</span><span class="fu">:</span> <span class="st">"268435456"</span></span>
<span id="cb5-14"><a href=""></a> <span class="fu">}</span></span>
<span id="cb5-15"><a href=""></a> <span class="fu">}</span></span>
<span id="cb5-16"><a href=""></a><span class="fu">}</span></span></code></pre></div>
</div></div>
</section>

<section id="delta-lake-4" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p>Checkpoint <code>00000000000000000002.checkpoint.parquet</code></p>

<img src="lakehouse/00000000000000000002.checkpoint.parquet.png" class="center r-stretch"></section>

<section id="delta-lake-5" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<div class="columns">
<div class="column" style="width:50%;">
<p>Once we have made several commits to the transaction log, Delta Lake saves a <strong>checkpoint file</strong> in Parquet format in <code>_delta_log</code></p>
<ul>
<li>Delta Lake automatically generates checkpoints as needed to maintain good read performance.</li>
<li>Checkpoints store all the non-redundant actions in the table’s log up to a certain log record ID, in Parquet format</li>
<li>Some sets of actions are redundant and can be removed</li>
<li>Read the <em>last checkpoint</em> object in the table’s log directory, if it exists, to obtain a recent checkpoint ID</li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="imgs/deltalake2.png"></p>
</div></div>
</section>

<section id="delta-lake-6" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<div class="columns">
<div class="column" style="width:50%;">
<p>Checkpoints save the entire state of the table at a point in time.</p>
<p>A “shortcut” to reproducing a table’s state to avoid reprocessing what could be thousands of tiny, inefficient JSON files.</p>
<p>Spark runs a <code>listFrom v</code> operation to view all files in the transaction log, starting from <code>v</code></p>
<ul>
<li>… quickly skips to the newest checkpoint file,</li>
<li>… only processes JSON commits made since the most recent checkpoint file was saved.</li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="imgs/deltalake3.png"></p>
</div></div>
<p>Imagine that we’ve created commits up to <code>000007.json</code> and that Spark has cached this version of the table in memory.</p>
<ul>
<li>In the meantime, other writers have written new data to the table, adding commits up to <code>0000012.json</code>.</li>
<li>To incorporate these new transactions, Spark runs a <code>listFrom</code> version 7 operation to see the new changes to the table.</li>
<li>Rather than processing all of the intermediate JSON files …</li>
<li>… Spark skips ahead to the most recent checkpoint file since it contains the entire state of the table at commit <code>#10</code>.</li>
</ul>
</section>

<section id="delta-lake-7" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p><strong>Time Travel</strong></p>
<ul>
<li>Every table is the sum of all commits recorded in the transaction log.</li>
<li>The log provides a step-by-step instruction guide, detailing how to get from the table’s original state to its current state.</li>
<li>Recreate a table at any point in time by starting with the original version and processing only commits before that version.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource sql number-lines"><code class="sourceCode sql"><span id="cb6-1"><a href=""></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> suppliers; <span class="co">-- read the last version of the table</span></span>
<span id="cb6-2"><a href=""></a><span class="kw">delete</span> <span class="kw">from</span> suppliers; <span class="co">-- delete all data from the table!</span></span>
<span id="cb6-3"><a href=""></a><span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> suppliers version <span class="kw">as</span> <span class="kw">of</span> <span class="dv">3</span>; <span class="co">-- read from a specific version of the table</span></span>
<span id="cb6-4"><a href=""></a>restore <span class="kw">table</span> suppliers <span class="kw">to</span> version <span class="kw">as</span> <span class="kw">of</span> <span class="dv">3</span>; <span class="co">-- restore to a specific version</span></span></code></pre></div>
<p><strong>Data Lineage and Debugging</strong></p>
<ul>
<li>The transaction log offers users a verifiable data lineage useful for governance, audit, and compliance purposes.</li>
<li>It can also be used to trace the origin of an inadvertent change or a bug in a pipeline back to the exact action that caused it.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource sql number-lines"><code class="sourceCode sql"><span id="cb7-1"><a href=""></a><span class="kw">delete</span> <span class="kw">from</span> suppliers; <span class="co">-- delete is important for GDPR</span></span>
<span id="cb7-2"><a href=""></a><span class="co">-- what about data in the log?</span></span></code></pre></div>
</section>

<section id="delta-lake-8" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<div class="columns">
<div class="column" style="width:60%;">
<p><strong>Optimize</strong>: Delta Lake can improve the speed of read queries from a table by coalescing small files into larger ones.</p>
<ul>
<li><em>Bin-packing optimization</em> is idempotent, meaning that if it is run twice on the same dataset, the second run has no effect.</li>
<li><em>Bin-packing</em> aims to produce evenly-balanced data files with respect to their size on disk, but not necessarily balanced #tuples.
<ul>
<li>However, the two measures are most often correlated.</li>
</ul></li>
<li>Python and Scala APIs for executing OPTIMIZE operations are available.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb8-1"><a href=""></a><span class="im">from</span> delta.tables <span class="im">import</span> <span class="op">*</span></span>
<span id="cb8-2"><a href=""></a>deltaTable <span class="op">=</span> DeltaTable.forPath(spark, pathToTable)  <span class="co"># For path-based tables</span></span>
<span id="cb8-3"><a href=""></a><span class="co"># For Hive metastore-based tables: deltaTable = DeltaTable.forName(spark, tableName)</span></span>
<span id="cb8-4"><a href=""></a>deltaTable.optimize().executeCompaction()</span>
<span id="cb8-5"><a href=""></a><span class="co"># If you have a large amount of data and only want to optimize a subset of it, you can specify an optional partition predicate using `where`</span></span>
<span id="cb8-6"><a href=""></a>deltaTable.optimize().where(<span class="st">"date='2021-11-18'"</span>).executeCompaction()</span></code></pre></div>
<p><em>Auto compaction</em> automatically reduce small file problems.</p>
<ul>
<li>Occur after a write to a table has succeeded and runs synchronously on the cluster that has performed the write.</li>
<li>Compact files that haven’t been compacted previously.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imgs/deltalake6.svg"></p>
<figcaption>Optimize</figcaption>
</figure>
</div>
</div></div>
</section>

<section id="delta-lake-9" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p>Example of a <em>write transaction</em>: read the data at table version <code>r</code> and attempt to write log record <code>r+1</code></p>
<ul>
<li>Read data at table version <code>r</code>, if required combine previous checkpoint and further log records</li>
<li>Write any new data into new files in the correct data directories, generating the object names using GUIDs.
<ul>
<li>This step can happen in parallel</li>
<li>At the end, these objects are ready to be referenced in a new log record.</li>
</ul></li>
<li>Attempt to write the transaction’s log record into the <code>r+1.json</code> log object, if no other client has written this object
<ul>
<li><em>This step needs to be atomic</em>: only 1 client should succeed.</li>
<li>If the step fails, the transaction can be retried; depending on the query’s semantics (optimistic concurrency)</li>
</ul></li>
<li>Optionally, write a new <code>.parquet</code> checkpoint for log record <code>r+1</code></li>
</ul>
<p>Not all large-scale storage systems have an atomic put operation</p>
<ul>
<li>Google Cloud Storage and Azure Blob Store support atomic put-if-absent operations</li>
<li>HDFS, we use atomic renames to rename a temporary file to the target name</li>
<li>Amazon S3 needs ad-hoc protocols</li>
</ul>
</section>

<section id="delta-lake-10" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p>Check the scalability with respect to the length of the log</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb9-1"><a href=""></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-2"><a href=""></a><span class="cf">while</span> i <span class="op">&lt;</span> <span class="dv">20000</span>:</span>
<span id="cb9-3"><a href=""></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-4"><a href=""></a>        spark.sql(<span class="st">"select sum(quantity) from lineitem"</span>)  <span class="co"># Read the whole fact</span></span>
<span id="cb9-5"><a href=""></a>    spark.sql(<span class="st">"insert (500K tuples) into lineitem"</span>)  <span class="co"># Append new tuples</span></span>
<span id="cb9-6"><a href=""></a>    i <span class="op">+=</span> <span class="dv">1</span></span></code></pre></div>

<img data-src="imgs/deltalake8.png" class="r-stretch quarto-figure-center"><p class="caption">Scalability</p></section>

<section id="delta-lake-11" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p>Check the scalability with respect to the length of the log</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb10-1"><a href=""></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-2"><a href=""></a><span class="cf">while</span> i <span class="op">&lt;</span> <span class="dv">20000</span>:</span>
<span id="cb10-3"><a href=""></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb10-4"><a href=""></a>        spark.sql(<span class="st">"select sum(quantity) from lineitem"</span>)  <span class="co"># Read the whole fact</span></span>
<span id="cb10-5"><a href=""></a>    spark.sql(<span class="st">"insert (500K tuples) into lineitem"</span>)  <span class="co"># Append new tuples</span></span>
<span id="cb10-6"><a href=""></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>: OPTIMIZE  <span class="co"># Optimize</span></span>
<span id="cb10-7"><a href=""></a>    i <span class="op">+=</span> <span class="dv">1</span></span></code></pre></div>

<img data-src="imgs/deltalake4.png" class="r-stretch quarto-figure-center"><p class="caption">Scalability</p></section>

<section id="delta-lake-12" class="title-slide slide level1 center">
<h1>Delta Lake</h1>

<img alt="Scaling out performance" src="imgs/deltalake5.png" class="center r-stretch"></section>

<section id="delta-lake-13" class="title-slide slide level1 center">
<h1>Delta Lake</h1>
<p>Format-independent optimizations are</p>
<ul>
<li><em>Caching</em>: cache files from the cloud object store on faster storage devices such as SSDs and RAM on the processing nodes</li>
<li><em>Auxiliary data</em>: maintain column min-max statistics for each data file in the table within the same Parquet file used to store the transaction log</li>
<li><em>Data layout</em>:
<ul>
<li><em>Record ordering</em>: records clustered together are easiest to read together
<ul>
<li>E.g. ordering records using individual dimensions or space-filling curves such as Z-order</li>
</ul></li>
<li><em>Compression strategies</em> differently for various groups of records or other strategies</li>
</ul></li>
</ul>
<p>See also <a href="https://blog.det.life/i-spent-5-hours-understanding-more-about-the-delta-lake-table-format-b8516c5091eb">I spent 5 hours understanding more about the delta lake table format</a></p>
</section>

<section id="lakehouse" class="title-slide slide level1 center">
<h1>Lakehouse</h1>
<p>A <strong>medallion architecture</strong> is a data design pattern used to logically organize data in a lakehouse, with the goal of incrementally and progressively improving the structure and quality of data as it flows through each layer of the architecture</p>

<img data-src="imgs/building-data-pipelines-with-delta-lake-120823.png" class="r-stretch quarto-figure-center"><p class="caption">Medallion architecture</p></section>

<section id="lakehouse-1" class="title-slide slide level1 center">
<h1>Lakehouse</h1>
<p>Example of usage</p>

<img src="imgs/deltalake7.svg" class="center r-stretch"></section>

<section id="references" class="title-slide slide level1 smaller scrollable">
<h1>References</h1>

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-armbrust2020delta" class="csl-entry" role="listitem">
Armbrust, Michael, Tathagata Das, Liwen Sun, Burak Yavuz, Shixiong Zhu, Mukul Murthy, Joseph Torres, et al. 2020. <span>“Delta Lake: High-Performance ACID Table Storage over Cloud Object Stores.”</span> <em>Proceedings of the VLDB Endowment</em> 13 (12): 3411–24.
</div>
<div id="ref-armbrust2021lakehouse" class="csl-entry" role="listitem">
Armbrust, Michael, Ali Ghodsi, Reynold Xin, and Matei Zaharia. 2021. <span>“Lakehouse: A New Generation of Open Platforms That Unify Data Warehousing and Advanced Analytics.”</span> In <em>Proceedings of CIDR</em>, 8:28.
</div>
<div id="ref-couto2019mapping" class="csl-entry" role="listitem">
Couto, Julia, Olimar Teixeira Borges, Duncan D Ruiz, Sabrina Marczak, and Rafael Prikladnicki. 2019. <span>“A Mapping Study about Data Lakes: An Improved Definition and Possible Architectures.”</span> In <em>SEKE</em>, 453–578.
</div>
<div id="ref-mansouri2017data" class="csl-entry" role="listitem">
Mansouri, Yaser, Adel Nadjaran Toosi, and Rajkumar Buyya. 2017. <span>“Data Storage Management in Cloud Environments: Taxonomy, Survey, and Future Directions.”</span> <em>ACM Computing Surveys (CSUR)</em> 50 (6): 1–51.
</div>
</div>
</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>Matteo Francia - Big Data and Cloud Platforms (Module 2) - A.Y. 2024/25</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="06-storage_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="06-storage_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="06-storage_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="06-storage_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="06-storage_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="06-storage_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="06-storage_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="06-storage_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="06-storage_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="06-storage_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1100,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>