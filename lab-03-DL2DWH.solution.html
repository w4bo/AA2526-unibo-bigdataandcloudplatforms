<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="lab-03-DL2DWH.solution_files/libs/quarto-html/tabby.min.js"></script>
<script src="lab-03-DL2DWH.solution_files/libs/quarto-html/popper.min.js"></script>
<script src="lab-03-DL2DWH.solution_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="lab-03-DL2DWH.solution_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab-03-DL2DWH.solution_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="lab-03-DL2DWH.solution_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Matteo Francia   DISI — University of Bologna   m.francia@unibo.it">
  <title>DL2DWH Lab</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="lab-03-DL2DWH.solution_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="lab-03-DL2DWH.solution_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="lab-03-DL2DWH.solution_files/libs/revealjs/dist/theme/quarto-ed3ed8e2bee100c8aba16b41caadc9a2.css">
  <link href="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">DL2DWH Lab</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Matteo Francia <br> DISI — University of Bologna <br> m.francia@unibo.it 
</div>
</div>
</div>

</section>
<section class="slide level2">

</section>
<section>
<section id="dl2dwh-lab" class="title-slide slide level1 center">
<h1>DL2DWH Lab</h1>
<p>In this lab you are asked to cover the following points: 1. Data ingestion 2. Data understanding 3. Design and build a relational DWH 4. Query the DWH with Tableau (Desktop) 5. (Bonus) Plot the provenance graph</p>
</section>
<section class="slide level2">

<div id="0927b305" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb1-1"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href=""></a><span class="im">import</span> awswrangler <span class="im">as</span> wr</span>
<span id="cb1-3"><a href=""></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href=""></a><span class="im">import</span> prov</span></code></pre></div>
</details>
</div>
</section>
<section id="data-preparation" class="slide level2">
<h2>Data preparation</h2>
</section>
<section class="slide level2">

<div id="9ff64bba" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb2-1"><a href=""></a><span class="co"># get the raw data</span></span>
<span id="cb2-2"><a href=""></a>df <span class="op">=</span> pd.read_csv(<span class="st">'http://big.csr.unibo.it/projects/nosql-datasets/sales_fact_1997.orig.csv'</span>)</span>
<span id="cb2-3"><a href=""></a>df</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Birthdate</th>
<th data-quarto-table-cell-role="th">Brand Name</th>
<th data-quarto-table-cell-role="th">C. City</th>
<th data-quarto-table-cell-role="th">C. Country</th>
<th data-quarto-table-cell-role="th">C. State</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Coffee Bar</th>
<th data-quarto-table-cell-role="th">Cost</th>
<th data-quarto-table-cell-role="th">Customer (Birthdate)</th>
<th data-quarto-table-cell-role="th">Customer (Card)</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Subcategory (Dep)</th>
<th data-quarto-table-cell-role="th">Subcategory (Family)</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">Video Store</th>
<th data-quarto-table-cell-role="th">Yearly Income</th>
<th data-quarto-table-cell-role="th">Number of Records</th>
<th data-quarto-table-cell-role="th">Store Cost</th>
<th data-quarto-table-cell-role="th">Store Sales</th>
<th data-quarto-table-cell-role="th">Unit Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2/25/1954</td>
<td>CDR</td>
<td>Walla Walla</td>
<td>USA</td>
<td>WA</td>
<td>Jams and Jellies</td>
<td>0</td>
<td>0</td>
<td>3446</td>
<td>3446</td>
<td>...</td>
<td>Jam</td>
<td>Jam</td>
<td>Jam</td>
<td>Small Grocery</td>
<td>0</td>
<td>$30K - $50K</td>
<td>1</td>
<td>3.0480</td>
<td>7.62</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2/25/1954</td>
<td>Landslide</td>
<td>Walla Walla</td>
<td>USA</td>
<td>WA</td>
<td>Jams and Jellies</td>
<td>0</td>
<td>0</td>
<td>3446</td>
<td>3446</td>
<td>...</td>
<td>Peanut Butter</td>
<td>Peanut Butter</td>
<td>Peanut Butter</td>
<td>Small Grocery</td>
<td>0</td>
<td>$30K - $50K</td>
<td>1</td>
<td>1.9740</td>
<td>4.20</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2/25/1954</td>
<td>Fort West</td>
<td>Walla Walla</td>
<td>USA</td>
<td>WA</td>
<td>Snack Foods</td>
<td>0</td>
<td>0</td>
<td>3446</td>
<td>3446</td>
<td>...</td>
<td>Chips</td>
<td>Chips</td>
<td>Chips</td>
<td>Small Grocery</td>
<td>0</td>
<td>$30K - $50K</td>
<td>1</td>
<td>5.2380</td>
<td>11.64</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2/25/1954</td>
<td>Horatio</td>
<td>Walla Walla</td>
<td>USA</td>
<td>WA</td>
<td>Snack Foods</td>
<td>0</td>
<td>0</td>
<td>3446</td>
<td>3446</td>
<td>...</td>
<td>Dried Fruit</td>
<td>Dried Fruit</td>
<td>Dried Fruit</td>
<td>Small Grocery</td>
<td>0</td>
<td>$30K - $50K</td>
<td>1</td>
<td>1.8744</td>
<td>5.68</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2/25/1954</td>
<td>Red Wing</td>
<td>Walla Walla</td>
<td>USA</td>
<td>WA</td>
<td>Paper Products</td>
<td>0</td>
<td>0</td>
<td>3446</td>
<td>3446</td>
<td>...</td>
<td>Paper Wipes</td>
<td>Paper Wipes</td>
<td>Paper Wipes</td>
<td>Small Grocery</td>
<td>0</td>
<td>$30K - $50K</td>
<td>1</td>
<td>1.7384</td>
<td>4.24</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86832</td>
<td>6/19/1915</td>
<td>Super</td>
<td>Downey</td>
<td>USA</td>
<td>CA</td>
<td>Jams and Jellies</td>
<td>1</td>
<td>12820</td>
<td>5566</td>
<td>5566</td>
<td>...</td>
<td>Jelly</td>
<td>Jelly</td>
<td>Jelly</td>
<td>Gourmet Supermarket</td>
<td>1</td>
<td>$50K - $70K</td>
<td>1</td>
<td>3.7152</td>
<td>7.74</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86833</td>
<td>6/19/1915</td>
<td>Booker</td>
<td>Downey</td>
<td>USA</td>
<td>CA</td>
<td>Dairy</td>
<td>1</td>
<td>12820</td>
<td>5566</td>
<td>5566</td>
<td>...</td>
<td>Cheese</td>
<td>Cheese</td>
<td>Cheese</td>
<td>Gourmet Supermarket</td>
<td>1</td>
<td>$50K - $70K</td>
<td>1</td>
<td>2.0535</td>
<td>5.55</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86834</td>
<td>6/19/1915</td>
<td>Club</td>
<td>Downey</td>
<td>USA</td>
<td>CA</td>
<td>Dairy</td>
<td>1</td>
<td>12820</td>
<td>5566</td>
<td>5566</td>
<td>...</td>
<td>Cheese</td>
<td>Cheese</td>
<td>Cheese</td>
<td>Gourmet Supermarket</td>
<td>1</td>
<td>$50K - $70K</td>
<td>1</td>
<td>5.9250</td>
<td>11.85</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86835</td>
<td>6/19/1915</td>
<td>Imagine</td>
<td>Downey</td>
<td>USA</td>
<td>CA</td>
<td>Frozen Desserts</td>
<td>1</td>
<td>12820</td>
<td>5566</td>
<td>5566</td>
<td>...</td>
<td>Ice Cream</td>
<td>Ice Cream</td>
<td>Ice Cream</td>
<td>Gourmet Supermarket</td>
<td>1</td>
<td>$50K - $70K</td>
<td>1</td>
<td>2.6322</td>
<td>6.42</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86836</td>
<td>6/19/1915</td>
<td>Choice</td>
<td>Downey</td>
<td>USA</td>
<td>CA</td>
<td>Candy</td>
<td>1</td>
<td>12820</td>
<td>5566</td>
<td>5566</td>
<td>...</td>
<td>Chocolate Candy</td>
<td>Chocolate Candy</td>
<td>Chocolate Candy</td>
<td>Gourmet Supermarket</td>
<td>1</td>
<td>$50K - $70K</td>
<td>1</td>
<td>2.1528</td>
<td>5.52</td>
<td>3</td>
</tr>
</tbody>
</table>

<p>86837 rows × 56 columns</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div id="575f29b7" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb3-1"><a href=""></a><span class="co"># take a look at the columns</span></span>
<span id="cb3-2"><a href=""></a>df.info()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 86837 entries, 0 to 86836
Data columns (total 56 columns):
 #   Column                 Non-Null Count  Dtype  
---  ------                 --------------  -----  
 0   Birthdate              86837 non-null  object 
 1   Brand Name             86837 non-null  object 
 2   C. City                86837 non-null  object 
 3   C. Country             86837 non-null  object 
 4   C. State               86837 non-null  object 
 5   Category               86837 non-null  object 
 6   Coffee Bar             86837 non-null  int64  
 7   Cost                   86837 non-null  int64  
 8   Customer (Birthdate)   86837 non-null  int64  
 9   Customer (Card)        86837 non-null  int64  
 10  Customer (Education)   86837 non-null  int64  
 11  Customer (Income)      86837 non-null  int64  
 12  Customer (Location)    86837 non-null  int64  
 13  Customer (Occupation)  86837 non-null  int64  
 14  Customer (Sex)         86837 non-null  int64  
 15  Customer (Status)      86837 non-null  int64  
 16  Department             86837 non-null  object 
 17  Education              86837 non-null  object 
 18  End Date               23181 non-null  object 
 19  Family                 86837 non-null  object 
 20  Florist                86837 non-null  int64  
 21  Gender                 86837 non-null  object 
 22  Marital Status         86837 non-null  object 
 23  Media Type             86837 non-null  object 
 24  Member Card            86837 non-null  object 
 25  Occupation             86837 non-null  object 
 26  Product (Brand)        86837 non-null  object 
 27  Product (Category)     86837 non-null  object 
 28  Product (Department)   86837 non-null  object 
 29  Product (Family)       86837 non-null  object 
 30  Promotion (Cost)       86837 non-null  int64  
 31  Promotion (End)        86837 non-null  int64  
 32  Promotion (Media)      86837 non-null  int64  
 33  Promotion (Start)      86837 non-null  int64  
 34  S. City                86837 non-null  object 
 35  S. Country             86837 non-null  object 
 36  S. State               86837 non-null  object 
 37  Salad Bar              86837 non-null  int64  
 38  Sales Date             86837 non-null  object 
 39  Start Date             23181 non-null  object 
 40  Store                  86837 non-null  int64  
 41  Store (Coffee)         86837 non-null  int64  
 42  Store (Florist)        86837 non-null  int64  
 43  Store (Salad)          86837 non-null  int64  
 44  Store (Type)           86837 non-null  int64  
 45  Store (Video)          86837 non-null  int64  
 46  Subcategory            86837 non-null  object 
 47  Subcategory (Dep)      86837 non-null  object 
 48  Subcategory (Family)   86837 non-null  object 
 49  Type                   86837 non-null  object 
 50  Video Store            86837 non-null  int64  
 51  Yearly Income          86837 non-null  object 
 52  Number of Records      86837 non-null  int64  
 53  Store Cost             86837 non-null  float64
 54  Store Sales            86837 non-null  float64
 55  Unit Sales             86837 non-null  int64  
dtypes: float64(2), int64(25), object(29)
memory usage: 37.1+ MB</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div id="b813dadb" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb5-1"><a href=""></a><span class="co"># select a subset of columns</span></span>
<span id="cb5-2"><a href=""></a>columns <span class="op">=</span> [</span>
<span id="cb5-3"><a href=""></a>    <span class="st">"C. City"</span>, <span class="st">"C. Country"</span>, <span class="st">"C. State"</span>, <span class="st">"Customer (Location)"</span>, <span class="st">"Yearly Income"</span>,</span>
<span id="cb5-4"><a href=""></a>    <span class="st">"Category"</span>, <span class="st">"Subcategory"</span>, <span class="st">"Family"</span>, <span class="st">"Product (Category)"</span>,</span>
<span id="cb5-5"><a href=""></a>    <span class="st">"S. City"</span>, <span class="st">"S. Country"</span>, <span class="st">"S. State"</span>, <span class="st">"Store"</span>, <span class="st">"Type"</span>,</span>
<span id="cb5-6"><a href=""></a>    <span class="st">"Sales Date"</span></span>
<span id="cb5-7"><a href=""></a>]</span>
<span id="cb5-8"><a href=""></a>df <span class="op">=</span> df[columns <span class="op">+</span> [<span class="st">"Store Cost"</span>, <span class="st">"Store Sales"</span>, <span class="st">"Unit Sales"</span>]].groupby(columns).first().reset_index()</span></code></pre></div>
</details>
</div>
</section>
<section class="slide level2">

<div id="1f614399" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb6-1"><a href=""></a><span class="co"># rename some columns</span></span>
<span id="cb6-2"><a href=""></a><span class="cf">if</span> <span class="st">"Customer (Location)"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb6-3"><a href=""></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{</span>
<span id="cb6-4"><a href=""></a>        <span class="st">'Customer (Location)'</span>: <span class="st">'Customer'</span>,</span>
<span id="cb6-5"><a href=""></a>        <span class="st">'Product (Category)'</span>: <span class="st">'Product'</span></span>
<span id="cb6-6"><a href=""></a>    })</span>
<span id="cb6-7"><a href=""></a>df</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C. City</th>
<th data-quarto-table-cell-role="th">C. Country</th>
<th data-quarto-table-cell-role="th">C. State</th>
<th data-quarto-table-cell-role="th">Customer</th>
<th data-quarto-table-cell-role="th">Yearly Income</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Family</th>
<th data-quarto-table-cell-role="th">Product</th>
<th data-quarto-table-cell-role="th">S. City</th>
<th data-quarto-table-cell-role="th">S. Country</th>
<th data-quarto-table-cell-role="th">S. State</th>
<th data-quarto-table-cell-role="th">Store</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">Sales Date</th>
<th data-quarto-table-cell-role="th">Store Cost</th>
<th data-quarto-table-cell-role="th">Store Sales</th>
<th data-quarto-table-cell-role="th">Unit Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Baking Goods</td>
<td>Cooking Oil</td>
<td>Food</td>
<td>Super Corn Oil</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>2.1177</td>
<td>5.43</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Baking Goods</td>
<td>Sauces</td>
<td>Food</td>
<td>Landslide Tomato Sauce</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>1.6500</td>
<td>5.00</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Baking Goods</td>
<td>Sugar</td>
<td>Food</td>
<td>Landslide Brown Sugar</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>5.3760</td>
<td>11.20</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Bathroom Products</td>
<td>Conditioner</td>
<td>Non-Consumable</td>
<td>Consolidated Silky Smooth Hair Conditioner</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>1.1466</td>
<td>2.94</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Beer and Wine</td>
<td>Wine</td>
<td>Drink</td>
<td>Pearl Merlot Wine</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>0.9288</td>
<td>2.16</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86824</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Jams and Jellies</td>
<td>Peanut Butter</td>
<td>Food</td>
<td>Plato Chunky Peanut Butter</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>6/30/1997 12:00:00 AM</td>
<td>1.9600</td>
<td>4.90</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86825</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Meat</td>
<td>Hot Dogs</td>
<td>Food</td>
<td>Cutting Edge Chicken Hot Dogs</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>6/30/1997 12:00:00 AM</td>
<td>1.4229</td>
<td>4.59</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86826</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Pizza</td>
<td>Pizza</td>
<td>Food</td>
<td>PigTail Frozen Pepperoni Pizza</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>3/1/1997 12:00:00 AM</td>
<td>1.0752</td>
<td>3.36</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86827</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Vegetables</td>
<td>Fresh Vegetables</td>
<td>Food</td>
<td>Ebony Garlic</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>2/11/1997 12:00:00 AM</td>
<td>4.3680</td>
<td>10.40</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86828</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Vegetables</td>
<td>Fresh Vegetables</td>
<td>Food</td>
<td>Hermanos Green Pepper</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>2/11/1997 12:00:00 AM</td>
<td>6.0216</td>
<td>15.44</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>86829 rows × 18 columns</p>
</div>
</div>
</div>
</section>
<section id="data-ingestion" class="slide level2">
<h2>Data ingestion</h2>
<ul>
<li>Upload the following files in S3 (remember the naming conventions of the data lake areas!)
<ul>
<li><a href="http://big.csr.unibo.it/projects/nosql-datasets/sales_fact_1997.slice-0-1.v0.0.1.csv">http://big.csr.unibo.it/projects/nosql-datasets/sales_fact_1997.slice-0-1.v0.0.1.csv</a></li>
<li><a href="http://big.csr.unibo.it/projects/nosql-datasets/sales_fact_1997.slice-1-2.v0.0.1.csv">http://big.csr.unibo.it/projects/nosql-datasets/sales_fact_1997.slice-1-2.v0.0.1.csv</a></li>
<li><a href="http://big.csr.unibo.it/projects/nosql-datasets/sales_fact_1997.slice-2-3.v0.0.1.csv">http://big.csr.unibo.it/projects/nosql-datasets/sales_fact_1997.slice-2-3.v0.0.1.csv</a></li>
</ul></li>
<li>Merge/Append them into a single Pandas DataFrame
<ul>
<li>Which is the underlying assumption so that <code>append</code> works?</li>
<li>See <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.append.html">https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.append.html</a></li>
</ul></li>
<li>Save the processed dataset into S3</li>
</ul>
</section>
<section class="slide level2">

<div id="5e84224b" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb7-1"><a href=""></a>landing_bucket <span class="op">=</span> <span class="st">"s3://landing-raw-sales-123/"</span></span>
<span id="cb7-2"><a href=""></a>staging_bucket <span class="op">=</span> <span class="st">"s3://staging-clean-sales-123/"</span></span>
<span id="cb7-3"><a href=""></a></span>
<span id="cb7-4"><a href=""></a>file_names <span class="op">=</span> [<span class="st">"sales_fact_1997.slice-0-1.v0.0.1.csv"</span>, <span class="st">"sales_fact_1997.slice-1-2.v0.0.1.csv"</span>, <span class="st">"sales_fact_1997.slice-2-3.v0.0.1.csv"</span>,]</span></code></pre></div>
</details>
</div>
</section>
<section class="slide level2">

<div id="3cd74c82" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb8-1"><a href=""></a><span class="co"># import from S3</span></span>
<span id="cb8-2"><a href=""></a>df <span class="op">=</span> wr.s3.read_csv(landing_bucket <span class="op">+</span> file_names[<span class="dv">0</span>])</span>
<span id="cb8-3"><a href=""></a><span class="cf">for</span> file_name <span class="kw">in</span> file_names[<span class="dv">1</span>:]:</span>
<span id="cb8-4"><a href=""></a>    df <span class="op">=</span> df.append(wr.s3.read_csv(landing_bucket <span class="op">+</span> file_name), ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-5"><a href=""></a>df</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C. City</th>
<th data-quarto-table-cell-role="th">C. Country</th>
<th data-quarto-table-cell-role="th">C. State</th>
<th data-quarto-table-cell-role="th">Customer</th>
<th data-quarto-table-cell-role="th">Yearly Income</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Family</th>
<th data-quarto-table-cell-role="th">Product</th>
<th data-quarto-table-cell-role="th">S. City</th>
<th data-quarto-table-cell-role="th">S. Country</th>
<th data-quarto-table-cell-role="th">S. State</th>
<th data-quarto-table-cell-role="th">Store</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">Sales Date</th>
<th data-quarto-table-cell-role="th">Store Cost</th>
<th data-quarto-table-cell-role="th">Store Sales</th>
<th data-quarto-table-cell-role="th">Unit Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Baking Goods</td>
<td>Cooking Oil</td>
<td>Food</td>
<td>Super Corn Oil</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>2.1177</td>
<td>5.43</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Baking Goods</td>
<td>Sauces</td>
<td>Food</td>
<td>Landslide Tomato Sauce</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>1.6500</td>
<td>5.00</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Baking Goods</td>
<td>Sugar</td>
<td>Food</td>
<td>Landslide Brown Sugar</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>5.3760</td>
<td>11.20</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Bathroom Products</td>
<td>Conditioner</td>
<td>Non-Consumable</td>
<td>Consolidated Silky Smooth Hair Conditioner</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>1.1466</td>
<td>2.94</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Beer and Wine</td>
<td>Wine</td>
<td>Drink</td>
<td>Pearl Merlot Wine</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>0.9288</td>
<td>2.16</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86824</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Jams and Jellies</td>
<td>Peanut Butter</td>
<td>Food</td>
<td>Plato Chunky Peanut Butter</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>6/30/1997 12:00:00 AM</td>
<td>1.9600</td>
<td>4.90</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86825</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Meat</td>
<td>Hot Dogs</td>
<td>Food</td>
<td>Cutting Edge Chicken Hot Dogs</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>6/30/1997 12:00:00 AM</td>
<td>1.4229</td>
<td>4.59</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86826</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Pizza</td>
<td>Pizza</td>
<td>Food</td>
<td>PigTail Frozen Pepperoni Pizza</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>3/1/1997 12:00:00 AM</td>
<td>1.0752</td>
<td>3.36</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86827</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Vegetables</td>
<td>Fresh Vegetables</td>
<td>Food</td>
<td>Ebony Garlic</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>2/11/1997 12:00:00 AM</td>
<td>4.3680</td>
<td>10.40</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86828</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Vegetables</td>
<td>Fresh Vegetables</td>
<td>Food</td>
<td>Hermanos Green Pepper</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>2/11/1997 12:00:00 AM</td>
<td>6.0216</td>
<td>15.44</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>86829 rows × 18 columns</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div id="15ae01ef" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="10">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb9-1"><a href=""></a><span class="co"># import directly from the sources</span></span>
<span id="cb9-2"><a href=""></a>url <span class="op">=</span> <span class="st">"http://big.csr.unibo.it/projects/nosql-datasets/"</span></span>
<span id="cb9-3"><a href=""></a>df <span class="op">=</span> pd.read_csv(url <span class="op">+</span> file_names[<span class="dv">0</span>])</span>
<span id="cb9-4"><a href=""></a><span class="cf">for</span> file_name <span class="kw">in</span> file_names[<span class="dv">1</span>:]:</span>
<span id="cb9-5"><a href=""></a>    df <span class="op">=</span> df.append(pd.read_csv(url <span class="op">+</span> file_name), ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-6"><a href=""></a>df</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">C. City</th>
<th data-quarto-table-cell-role="th">C. Country</th>
<th data-quarto-table-cell-role="th">C. State</th>
<th data-quarto-table-cell-role="th">Customer</th>
<th data-quarto-table-cell-role="th">Yearly Income</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Family</th>
<th data-quarto-table-cell-role="th">Product</th>
<th data-quarto-table-cell-role="th">S. City</th>
<th data-quarto-table-cell-role="th">S. Country</th>
<th data-quarto-table-cell-role="th">S. State</th>
<th data-quarto-table-cell-role="th">Store</th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">Sales Date</th>
<th data-quarto-table-cell-role="th">Store Cost</th>
<th data-quarto-table-cell-role="th">Store Sales</th>
<th data-quarto-table-cell-role="th">Unit Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Baking Goods</td>
<td>Cooking Oil</td>
<td>Food</td>
<td>Super Corn Oil</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>2.1177</td>
<td>5.43</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Baking Goods</td>
<td>Sauces</td>
<td>Food</td>
<td>Landslide Tomato Sauce</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>1.6500</td>
<td>5.00</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Baking Goods</td>
<td>Sugar</td>
<td>Food</td>
<td>Landslide Brown Sugar</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>5.3760</td>
<td>11.20</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Bathroom Products</td>
<td>Conditioner</td>
<td>Non-Consumable</td>
<td>Consolidated Silky Smooth Hair Conditioner</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>1.1466</td>
<td>2.94</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Albany</td>
<td>USA</td>
<td>OR</td>
<td>117</td>
<td>$90K - $110K</td>
<td>Beer and Wine</td>
<td>Wine</td>
<td>Drink</td>
<td>Pearl Merlot Wine</td>
<td>Salem</td>
<td>USA</td>
<td>OR</td>
<td>13</td>
<td>Deluxe Supermarket</td>
<td>1/21/1997 12:00:00 AM</td>
<td>0.9288</td>
<td>2.16</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86824</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Jams and Jellies</td>
<td>Peanut Butter</td>
<td>Food</td>
<td>Plato Chunky Peanut Butter</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>6/30/1997 12:00:00 AM</td>
<td>1.9600</td>
<td>4.90</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86825</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Meat</td>
<td>Hot Dogs</td>
<td>Food</td>
<td>Cutting Edge Chicken Hot Dogs</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>6/30/1997 12:00:00 AM</td>
<td>1.4229</td>
<td>4.59</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86826</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Pizza</td>
<td>Pizza</td>
<td>Food</td>
<td>PigTail Frozen Pepperoni Pizza</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>3/1/1997 12:00:00 AM</td>
<td>1.0752</td>
<td>3.36</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86827</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Vegetables</td>
<td>Fresh Vegetables</td>
<td>Food</td>
<td>Ebony Garlic</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>2/11/1997 12:00:00 AM</td>
<td>4.3680</td>
<td>10.40</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86828</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>10226</td>
<td>$10K - $30K</td>
<td>Vegetables</td>
<td>Fresh Vegetables</td>
<td>Food</td>
<td>Hermanos Green Pepper</td>
<td>Yakima</td>
<td>USA</td>
<td>WA</td>
<td>23</td>
<td>Mid-Size Grocery</td>
<td>2/11/1997 12:00:00 AM</td>
<td>6.0216</td>
<td>15.44</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>86829 rows × 18 columns</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<p>Save the processed dataset into S3</p>
<div id="3cfff29a" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb10-1"><a href=""></a>wr.s3.to_csv(df, path<span class="op">=</span>staging_bucket <span class="op">+</span> <span class="st">"sales_fact_1997.v0.0.1.csv"</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>{'paths': ['s3://staging-clean-sales-123/sales_fact_1997.v0.0.1.csv'],
 'partitions_values': {}}</code></pre>
</div>
</div>
</section>
<section id="data-understanding" class="slide level2">
<h2>Data understanding</h2>
<ul>
<li>What is the dataset about?</li>
<li>Which are candidate levels/measures?</li>
<li>Check and fix the missing values (if any)</li>
<li>How many products have been sold?
<ul>
<li>See <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.value_counts.html">https://pandas.pydata.org/docs/reference/api/pandas.Series.value_counts.html</a></li>
</ul></li>
<li>Which functional dependencies hold among the levels?
<ul>
<li>Given a relation R, a set of attributes X in R is said to functionally determine another set of attributes Y, also in R, (written X → Y) if, and only if, each X value is associated with precisely one Y value; R is then said to satisfy the functional dependency X → Y.</li>
<li>See <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.nunique.html">https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.nunique.html</a></li>
<li>Hint: <code>df.groupby([...])</code> + <code>nunique()</code></li>
</ul></li>
<li>Are there relationships between measures?
<ul>
<li>See <a href="https://seaborn.pydata.org/generated/seaborn.pairplot.html">https://seaborn.pydata.org/generated/seaborn.pairplot.html</a></li>
<li>See <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.corr.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.corr.html</a></li>
</ul></li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>What is the dataset about?</li>
<li>Which are candidate levels/measures?
<ul>
<li><code>Store Cost</code>, <code>Store Sales</code>, <code>Unit Sales</code> are candidate measures, the others are candidate levels</li>
</ul></li>
</ul>
<div id="4574a046" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb12-1"><a href=""></a>df.info()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 86829 entries, 0 to 86828
Data columns (total 18 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   C. City        86829 non-null  object 
 1   C. Country     86829 non-null  object 
 2   C. State       86829 non-null  object 
 3   Customer       86829 non-null  int64  
 4   Yearly Income  86829 non-null  object 
 5   Category       86829 non-null  object 
 6   Subcategory    86829 non-null  object 
 7   Family         86829 non-null  object 
 8   Product        86829 non-null  object 
 9   S. City        86829 non-null  object 
 10  S. Country     86829 non-null  object 
 11  S. State       86829 non-null  object 
 12  Store          86829 non-null  int64  
 13  Type           86829 non-null  object 
 14  Sales Date     86829 non-null  object 
 15  Store Cost     86829 non-null  float64
 16  Store Sales    86829 non-null  float64
 17  Unit Sales     86829 non-null  int64  
dtypes: float64(2), int64(3), object(13)
memory usage: 11.9+ MB</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>How many products have been sold?</p>
<div id="b9d83c5a" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb14-1"><a href=""></a>df[[<span class="st">"Product"</span>]].value_counts()</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Product                   
Special Wheat Puffs           89
Hermanos Broccoli             82
Big Time Ice Cream            80
Red Wing 60 Watt Lightbulb    80
Fast Beef Jerky               79
                              ..
Choice Bubble Gum             33
High Top Honey Dew            32
CDR Oregano                   31
CDR Apple Preserves           27
Washington Berry Juice        26
Length: 1559, dtype: int64</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Which functional dependencies hold among the levels?</p>
<ul>
<li>Given a relation R, a set of attributes X in R is said to functionally determine another set of attributes Y, also in R, (written X → Y) if, and only if, each X value is associated with precisely one Y value; R is then said to satisfy the functional dependency X → Y.</li>
</ul>
<p>What about <code>Family</code>?</p>
</section>
<section class="slide level2">

<div id="161bdadc" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="14">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb16-1"><a href=""></a>df.groupby([<span class="st">"Product"</span>])[<span class="st">"Subcategory"</span>, <span class="st">"Category"</span>, <span class="st">"Family"</span>].nunique()</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Family</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Product</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ADJ Rosy Sunglasses</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Akron City Map</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Akron Eyeglass Screwdriver</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">American Beef Bologna</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">American Chicken Hot Dogs</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Washington Diet Cola</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Washington Diet Soda</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Washington Mango Drink</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Washington Orange Juice</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Washington Strawberry Drink</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>1559 rows × 3 columns</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div id="ad8e8e1e" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="15">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb17-1"><a href=""></a>df.groupby([<span class="st">"Subcategory"</span>])[<span class="st">"Category"</span>, <span class="st">"Family"</span>].nunique()</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Category</th>
<th data-quarto-table-cell-role="th">Family</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Subcategory</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Acetominifen</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Anchovies</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aspirin</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Auto Magazines</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bagels</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Toothbrushes</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Tuna</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Waffles</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Wine</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Yogurt</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>102 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section class="slide level2">

<div id="da6c5e9f" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="16">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb18-1"><a href=""></a>df.groupby([<span class="st">"Category"</span>])[<span class="st">"Family"</span>].nunique()</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>Category
Baking Goods            1
Bathroom Products       1
Beer and Wine           1
Bread                   1
Breakfast Foods         1
Candles                 1
Candy                   1
Canned Anchovies        1
Canned Clams            1
Canned Oysters          1
Canned Sardines         1
Canned Shrimp           1
Canned Soup             1
Canned Tuna             1
Carbonated Beverages    1
Cleaning Supplies       1
Cold Remedies           1
Dairy                   2
Decongestants           1
Drinks                  1
Eggs                    1
Electrical              1
Frozen Desserts         1
Frozen Entrees          1
Fruit                   1
Hardware                1
Hot Beverages           1
Hygiene                 1
Jams and Jellies        1
Kitchen Products        1
Magazines               1
Meat                    1
Miscellaneous           1
Packaged Vegetables     1
Pain Relievers          1
Paper Products          1
Pizza                   1
Plastic Products        1
Pure Juice Beverages    1
Seafood                 1
Side Dishes             1
Snack Foods             1
Specialty               2
Starchy Foods           1
Vegetables              1
Name: Family, dtype: int64</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div id="ea084847" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="17">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb20-1"><a href=""></a>df.groupby([<span class="st">"Family"</span>])[<span class="st">"Category"</span>].nunique()</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Family
Drink              6
Food              26
Non-Consumable    15
Name: Category, dtype: int64</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Are there relationships between measures?</p>
<div id="c970088d" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;-&quot;}" data-execution_count="18">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb22-1"><a href=""></a>sns.pairplot(df[[<span class="st">"Store Cost"</span>, <span class="st">"Store Sales"</span>, <span class="st">"Unit Sales"</span>]])</span></code></pre></div>
</details>

</div>
<img data-src="lab-03-DL2DWH.solution_files/figure-revealjs/cell-17-output-1.png" class="r-stretch"></section>
<section class="slide level2">

<div id="5fb9a2f3" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="19">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb23-1"><a href=""></a>df[[<span class="st">"Store Cost"</span>, <span class="st">"Store Sales"</span>, <span class="st">"Unit Sales"</span>]].corr()</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Store Cost</th>
<th data-quarto-table-cell-role="th">Store Sales</th>
<th data-quarto-table-cell-role="th">Unit Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Store Cost</td>
<td>1.000000</td>
<td>0.954650</td>
<td>0.492843</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Store Sales</td>
<td>0.954650</td>
<td>1.000000</td>
<td>0.516071</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Unit Sales</td>
<td>0.492843</td>
<td>0.516071</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="design-and-build-a-relational-dwh" class="slide level2">
<h2>Design and build a relational DWH</h2>
<ul>
<li>Create the database on Amazon RDS</li>
<li>Design the relational schema of the DWH (which are the functional dependencies?)</li>
<li>Upload the tables into rhw DWH</li>
</ul>
</section>
<section class="slide level2">

<div id="1651354b" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="20">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb24-1"><a href=""></a>host <span class="op">=</span> <span class="st">"sensor-dwh.cd97tkze3ics.us-east-1.rds.amazonaws.com"</span></span>
<span id="cb24-2"><a href=""></a>port <span class="op">=</span> <span class="dv">5432</span></span>
<span id="cb24-3"><a href=""></a>user <span class="op">=</span> <span class="st">"postgres"</span></span>
<span id="cb24-4"><a href=""></a>pwd <span class="op">=</span> <span class="st">"bigdata2022"</span></span>
<span id="cb24-5"><a href=""></a>db <span class="op">=</span> <span class="st">"postgres"</span></span>
<span id="cb24-6"><a href=""></a></span>
<span id="cb24-7"><a href=""></a><span class="im">from</span> sqlalchemy <span class="im">import</span> create_engine</span>
<span id="cb24-8"><a href=""></a>s <span class="op">=</span> <span class="st">'postgresql://</span><span class="sc">{}</span><span class="st">:</span><span class="sc">{}</span><span class="st">@</span><span class="sc">{}</span><span class="st">:</span><span class="sc">{}</span><span class="st">/</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(user, pwd, host, <span class="bu">str</span>(port), db)</span>
<span id="cb24-9"><a href=""></a>engine <span class="op">=</span> create_engine(s)</span></code></pre></div>
</details>
</div>
</section>
<section class="slide level2">

<p>Doing some ETL</p>
<div id="23dd43dd" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;-&quot;}" data-execution_count="21">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb25-1"><a href=""></a><span class="co"># DT_customer</span></span>
<span id="cb25-2"><a href=""></a>df[[<span class="st">"C. City"</span>, <span class="st">"C. Country"</span>, <span class="st">"C. State"</span>, <span class="st">"Customer"</span>, <span class="st">"Yearly Income"</span>]] <span class="op">\</span></span>
<span id="cb25-3"><a href=""></a>    .drop_duplicates() <span class="op">\</span></span>
<span id="cb25-4"><a href=""></a>    .to_sql(<span class="st">'customer'</span>, engine, index<span class="op">=</span><span class="va">False</span>, if_exists<span class="op">=</span><span class="st">'replace'</span>)</span></code></pre></div>
</details>
</div>
<div id="958b0a06" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;-&quot;}" data-execution_count="22">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb26-1"><a href=""></a><span class="co"># DT_store</span></span>
<span id="cb26-2"><a href=""></a>df[[<span class="st">"S. City"</span>, <span class="st">"S. Country"</span>, <span class="st">"S. State"</span>, <span class="st">"Store"</span>, <span class="st">"Type"</span>]] <span class="op">\</span></span>
<span id="cb26-3"><a href=""></a>    .drop_duplicates() <span class="op">\</span></span>
<span id="cb26-4"><a href=""></a>    .to_sql(<span class="st">'store'</span>, engine, index<span class="op">=</span><span class="va">False</span>, if_exists<span class="op">=</span><span class="st">'replace'</span>)</span></code></pre></div>
</details>
</div>
</section>
<section class="slide level2">

<div id="d99e6e56" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="23">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb27-1"><a href=""></a><span class="co"># DT_product</span></span>
<span id="cb27-2"><a href=""></a>df[[<span class="st">"Category"</span>, <span class="st">"Subcategory"</span>, <span class="st">"Family"</span>, <span class="st">"Product"</span>]] <span class="op">\</span></span>
<span id="cb27-3"><a href=""></a>    .drop_duplicates() <span class="op">\</span></span>
<span id="cb27-4"><a href=""></a>    .to_sql(<span class="st">'product'</span>, engine, index<span class="op">=</span><span class="va">False</span>, if_exists<span class="op">=</span><span class="st">'replace'</span>)</span></code></pre></div>
</details>
</div>
<div id="a30dbecc" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;-&quot;}" data-execution_count="24">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb28-1"><a href=""></a><span class="co"># DT_date</span></span>
<span id="cb28-2"><a href=""></a>df[[<span class="st">"Sales Date"</span>]] <span class="op">\</span></span>
<span id="cb28-3"><a href=""></a>    .drop_duplicates() <span class="op">\</span></span>
<span id="cb28-4"><a href=""></a>    .to_sql(<span class="st">'date'</span>, engine, index<span class="op">=</span><span class="va">False</span>, if_exists<span class="op">=</span><span class="st">'replace'</span>)</span></code></pre></div>
</details>
</div>
<div id="7be078b4" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;-&quot;}" data-execution_count="25">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb29-1"><a href=""></a><span class="co"># FT</span></span>
<span id="cb29-2"><a href=""></a>df[[<span class="st">"Customer"</span>, <span class="st">"Store"</span>, <span class="st">"Product"</span>, <span class="st">"Sales Date"</span>, <span class="st">"Store Sales"</span>, <span class="st">"Store Cost"</span>, <span class="st">"Unit Sales"</span>]] <span class="op">\</span></span>
<span id="cb29-3"><a href=""></a>    .to_sql(<span class="st">'sales'</span>, engine, index<span class="op">=</span><span class="va">False</span>, if_exists<span class="op">=</span><span class="st">'replace'</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="query-the-dwh-with-tableau-desktop" class="slide level2">
<h2>Query the DWH with Tableau (Desktop)</h2>
<ul>
<li>Import data from Amazon RDS into Tableau</li>
<li>Join the tables</li>
<li>Set <code>Sales Date</code> as a Datetime attribute both in the fact and dimension tables</li>
<li>Build the dimensions and hierarchies in Tableau</li>
<li>Complete the following exercises</li>
</ul>
</section>
<section class="slide level2">

<h3 id="exercise-1">Exercise 1</h3>
<ol type="1">
<li>Using a bar chart, display the <code>sum</code> of <code>Store Sales</code> for each <code>S. State</code>
<ul>
<li>Which state has the highest sales?</li>
</ul></li>
<li>Drill down to view sales at the <code>S. City</code> level.
<ul>
<li>Are there cities with much lower sales than others?</li>
</ul></li>
<li>How many stores (<code>Stores</code>) are there in each <code>S. State</code>? What about in each <code>S. City</code>?
<ul>
<li>Tip: Use <code>COUNTD</code> aggregation. Why?</li>
</ul></li>
<li>Can low sales in some cities be imputed to the number of stores?
<ul>
<li>Display sales at the <code>S. City</code> level (as done above) and associate the color property with the number of distinct stores (<code>COUNTD(store)</code>)</li>
</ul></li>
</ol>
</section>
<section class="slide level2">

<h3 id="exercise-2">Exercise 2</h3>
<ol start="5" type="1">
<li>Given the last visualization, associate the <code>S. Type</code> field with the color property.
<ul>
<li>What interesting pattern can you see?</li>
</ul></li>
<li>Display the sales (<code>SUM</code>) for each <code>S. Type</code>.
<ul>
<li>What discrepancy is possible to notice with respect to the previous chart?</li>
</ul></li>
<li>Associate the number of stores (<code>Store</code>) with the color property and the label property
<ul>
<li>What caused the discrepancy between the previous two visualizations?</li>
</ul></li>
</ol>
</section>
<section class="slide level2">

<h3 id="exercise-3">Exercise 3</h3>
<ol start="8" type="1">
<li>Using a line chart, visualize the monthly sales trend
<ul>
<li>What pattern is present?</li>
</ul></li>
<li>Divide the previous chart by <code>S. State</code> (one axis for each state)
<ul>
<li>Is the previous pattern present in each <code>State</code>?</li>
<li>Tip: by default the axes all have the same range: on any axis, right-click &gt; <code>Edit Axis</code> &gt; <code>Select Independent axis...</code></li>
</ul></li>
<li>Given the previous chart, visualize how much impact the various <code>Family</code>s have on total sales while maintaining the monthly trend visualization
<ul>
<li>What might be a good visualization?</li>
<li>Tip: associate each Family with a mark property and possibly change the mark type</li>
<li>Tip: you can change the mark type from the drop-down menu in the mark panel</li>
</ul></li>
</ol>
</section>
<section id="bonus-plot-the-provenance-graph" class="slide level2">
<h2>(Bonus) Plot the provenance graph</h2>
<ul>
<li>Plot the provenance graph representing the previous transformations using the PROV standard</li>
</ul>
<div id="48e8df41" class="cell" data-execution_count="27">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines"><code class="sourceCode python"><span id="cb30-1"><a href=""></a>plot()</span></code></pre></div>
</details>

</div>

<img data-src="lab-03-DL2DWH.solution_files/figure-revealjs/cell-25-output-1.png" class="r-stretch"></section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>Matteo Francia - Big Data and Cloud Platforms (Module 2) - A.Y. 2024/25</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="lab-03-DL2DWH.solution_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1100,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>